<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta charset="UTF-8">
    <title>拖拽测试</title>
    <script type="text/javascript" src="../js/jquery-2.1.3.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/demoCss.css">
</head>
<body>
<div id="context">
    <ul>
        <li class="dragBox box1">
            <div class="dragHead"><span>标题</span></div>
            <span class="dragTag">1</span>
        </li>
        <li class="dragBox box2">
            <div class="dragHead"><span>标题</span></div>
            <span class="dragTag">2</span>
        </li>
    </ul>
</div>
</body>
<script type="text/javascript">

$(function(){
    $.each($(".dragTag"),function(i,e){
        dragSizeLister(e);
    });

    $.each($(".dragHead"),function(i,e){
        dragPositionLister(e);
    });

});

//box大小变动监听事件
function dragSizeLister(bar){
    var ep = bar.parentNode;
    $(bar).bind("mousedown",function(e){
        $(ep).bind("mousedown",resize);
        $(document).bind("mouseup",stop);
        $(ep).focus();
    });

    //改变大小
    function resize(e){
        var x = e.pageX - ep.offsetWidth;
        var y = e.pageY - ep.offsetHeight;
       $(document).bind("mousemove",function(e){
            $(ep).css({"width": (e.pageX - x),"height":(e.pageY - y)});
       });
    }
    //停止改变大小
    function stop(e){
        $(document).unbind("mousemove").unbind("mouseup");
        $(ep).unbind("mousedown").unbind("mouseup");

        //动画控制box大小到相近规格,如果对box的大小有规格控制的话
    }
    }

//box位置变动监听事件
function dragPositionLister(bar){
    var ep = bar.parentNode;
    $(bar).bind("mousedown",function(e){
        $(ep).bind("mousedown",move);
        $(document).bind("mouseup",stop);
        $(ep).focus();
    });

    function move(e){
        //获取鼠标按下时context外部边距
        var x = e.pageX - $(bar).offset().left;
        var y = e.pageY - $(bar).offset().top;
        $(document).mousemove(function(e){
            //计算鼠标移动后的位置-外边距，得到当前box相对于context的位置
            $(ep).css({"left":(e.pageX-x),"top":(e.pageY-y)});
        });
    }
    function stop(e){

        $(document).unbind("mousemove").unbind("mouseup");
        $(ep).unbind("mousedown").unbind("mouseup");
    }
    }
//box布局
function boxLayout(box){
    var boxAry = [];
    var headHeight = 20;//boxHead的高度
    //获取box对象
    $.each($(".dragBox"),function(e){
        var l = $(bar).offset().left,
             t = $(bar).offset().top,
             w = $(bar).offsetWidth,
             h = $(bar).offsetHeight;

        boxAry.push({
            //一个box有6个点
            "o":{'x':l,'y':t},
            "p":{'x':l + w,'y':t},
            "q":{'x':l + w,'y':t + headHeight},
            "r":{'x':l + w,'y':t + h},
            "s":{'x':l,'y':t + h},
            "t":{'x':l,'y':t + headHeight},

//            "x":$(bar).offset().left,
//            "y":$(bar).offset().top,
//            "w":$(bar).offsetWidth,
//            "h":$(bar).offsetHeight,
            "jq":$(bar),
        });
    });

    var length = boxAry.length;
    var actionAry = [];
    //筛选因移动有重叠部分的box，并确定变动方式
    for(var i=0;i<length;i++){
        var boxi = boxAry[i];
        if(box.is(boxi)){
            continue;
        }
        if(boxi.o.x >= boxj.o.x && boxi.o.x <= boxj.p.x){

        }
    }
    //按变动动作集变动
    for(var action in actionAry){

    }


    function boxCom(box1,box2){

    }
}
</script>
</html>